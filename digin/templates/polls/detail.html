{% extends 'base.html' %}
{% block content %}
<head>
<style>
body {
    background:#a2b9bc
}
.navbar-brand {
    font-family: 'Satisfy', cursive;
}
.vote {
  text-align: center;
}
input[type=submit] {
  background-color:#878f99;
  border: none;
  color: white;
  text-decoration: none;
  cursor: pointer;
  font-size: 20px;
}
input[type=choice] {
  background-color:#878f99;
  border: none;
  color: white;
  text-decoration: none;
  cursor: pointer;
  font-size: 20px;
}
.hover_img a { position:relative; }
.hover_img a span { position:absolute; display:none; z-index:99; }
.hover_img a:hover span { display:block; }

</style>


</head>
<nav class="navbar navbar-inverse">
    <div class="container-fluid">
    	<div class="collapse navbar-collapse">
    		<div class = "navbar-brand" >{{ question.question_text }}</div>
    		<div class = "navbar-brand navbar-right">{{ question.pub_date }}</h1></div>
    		<span class = "navbar-brand navbar-right " ><a href="{% url 'polls:home' %}"><span class="glyphicon glyphicon-off" aria-hidden="true"></span></a></span>
    	</div>
	</div>
</nav>
{% if error_message %}<p class="vote"><strong>{{ error_message }}</strong></p>{% endif %}

{% if question.is_active == False %}
	

		<h1> end of poll. The winner was {{winner.choice_text}}</h1>
	

{% else %}

<h1>Deadline: {{ question.deadline }}</h1>
<p id="demo"></p>


<form action="{% url 'polls:vote' question.id %}" method="post">
<div class="vote">
{% csrf_token %}
{% for choice in choices %}
    <input type="radio" name="choice" id="choice{{ forloop.counter }}" value="{{ choice.id }}" />
    <label for="choice{{ forloop.counter }}">{{ choice.name }}: {{ choice.votes }} votes
    	<div class="hover_img">
    	{% load static %}
	     <a href="#">See tags word cloud<span><img src="{% static "" %}{{choice.place_id.place_id}}.png" alt="image" height="100" /></span></a>
		</div>
    </label>
    <br />
{% endfor %}
<div class="vote">
<input type="submit" value="Vote" name="Vote"/>
<input type="submit" value="Delete" name="Delete"/>
</div>
</div>
</form>


<form method="post" action="{% url 'polls:addChoice' question.id %}" >
<div class="vote">

{% csrf_token %}
    <input id="choice" type="text" name="choice" value="{{ choice }}" maxlength="200" style="width:200px">
	  
    <input id="placeId" type="hidden" name="placeId" value="" maxlength="200">

    <input type="submit" value="Add Choice">
	
</vote>
<script>
	var deadline = "{{question.deadline}}";
	// April 16, 2019, 1 p.m.
	var deadline_date_list = deadline.split(",")
	var date = deadline_date_list[0];
	var year = deadline_date_list[1];
	var time = deadline_date_list[2];
	var digit = time.split(" ");
	var hour = digit[1].split(":")[0];
	var minute = ""
	if (digit[1].split(":").length > 1){
		minute = digit[1].split(":")[1];
	}
	if (digit[2] == "p.m."){
		hour = (parseInt(hour)+12).toString();
	}
	// console.log(date+ " " + year + " " + hour + ":" + minute + ":00:00");
	var countDownDate = new Date(date+ " " + year + " " + hour + ":" + minute + ":00:00").getTime();
	
	var x = setInterval(function() {

		// Get todays date and time
		var now = new Date().getTime();
		// console.log(now);
		// Find the distance between now and the count down date
		var distance = countDownDate - now;

		// Time calculations for days, hours, minutes and seconds
		var days = Math.floor(distance / (1000 * 60 * 60 * 24));
		var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
		var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
		var seconds = Math.floor((distance % (1000 * 60)) / 1000);

		// Display the result in the element with id="demo"
		document.getElementById("demo").innerHTML = days + "d " + hours + "h "
		+ minutes + "m " + seconds + "s ";

		// If the count down is finished, write some text 
		if (distance < 0) {
			clearInterval(x);
			document.getElementById("demo").innerHTML = "EXPIRED";
		}
		}, 1000);



	var autocomplete;
	function activatePlacesSearch(){
		var sessionToken = new google.maps.places.AutocompleteSessionToken();
		var input = document.getElementById('choice');
		var options={types:['establishment']};
		autocomplete=new google.maps.places.Autocomplete(input,options);
		autocomplete.addListener('place_changed',onPlaceChanged);
	}
	function onPlaceChanged(){
		var place=autocomplete.getPlace();
		console.log(place);
	    var inp_place_id=document.getElementById("placeId");
	    inp_place_id.value=place.place_id;
	    console.log(inp_place_id);
	    console.log(place);
	    console.log(place.place_id);
    var inp_choice=document.getElementById("choice");
		choice.value=place.name;
		console.log(place.formatted_address);
	}
</script>
	
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAQs1AhWqKf-H-TNVh6j1moFjTwBfAn97s&libraries=places&callback=activatePlacesSearch"></script>

</form>
{% endif %}
{% endblock %}



