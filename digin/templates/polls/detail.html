{% extends 'base.html' %}
{% block content %}
<head>
<style>
body {
    background:#a2b9bc
}
.navbar-brand {
    font-family: 'Satisfy', cursive;
}
.vote {
  text-align: center;
}
input[type=submit] {
  background-color:#878f99;
  border: none;
  color: white;
  text-decoration: none;
  cursor: pointer;
  font-size: 20px;
}
input[type=choice] {
  background-color:#878f99;
  border: none;
  color: white;
  text-decoration: none;
  cursor: pointer;
  font-size: 20px;
}

.chart-container {
    width: 200px;
    height:200px
}
</style>
</head>
<nav class="navbar navbar-inverse">
    <div class="container-fluid">
    	<div class="collapse navbar-collapse">
    		<div class = "navbar-brand" >{{ question.question_text }}</div>
    		<div class = "navbar-brand navbar-right">{{ question.pub_date }}</h1></div>
    		<span class = "navbar-brand navbar-right " ><a href="{% url 'polls:home' %}"><span class="glyphicon glyphicon-off" aria-hidden="true"></span></a></span>
    	</div>
	</div>
</nav>
{% if error_message %}<p class="vote"><strong>{{ error_message }}</strong></p>{% endif %}

<form action="{% url 'polls:vote' question.id %}" method="post">
<div class="vote">
{% csrf_token %}
{% for choice in choices %}
    <input type="radio" name="choice" id="choice{{ forloop.counter }}" value="{{ choice.id }}" />
    <label for="choice{{ forloop.counter }}">{{ choice.choice_text }}: {{ choice.votes }} votes</label><br />
{% endfor %}
<div class="vote">
<input type="submit" value="Vote" name="Vote"/>
<input type="submit" value="Delete" name="Delete"/>
</div>
</div>
</form>


<form method="post" action="{% url 'polls:addChoice' question.id %}" >
<div class="vote">

{% csrf_token %}
    <input id="choice" type="text" name="choice" value="{{ choice }}" maxlength="200" style="width:200px">
	<input id="address" type="hidden" name="address" value="" maxlength="200">
	<input id="placeid" type="hidden" name="placeid" value="" maxlength="200">
    <input type="submit" value="Add Choice">
	
</vote>
<script>
	var autocomplete;
	function activatePlacesSearch(){
		var sessionToken = new google.maps.places.AutocompleteSessionToken();
		var input = document.getElementById('choice');
		var options={types:['establishment']};
		autocomplete=new google.maps.places.Autocomplete(input,options);
		autocomplete.addListener('place_changed',onPlaceChanged);
	}
	function onPlaceChanged(){
		var place=autocomplete.getPlace();
		var inp_address=document.getElementById("address");
		inp_address.value=place.formatted_address;
		var inp_placeid=document.getElementById("placeid");
		inp_placeid.value=place.place_id;
		console.log(inp_placeid.value);
		var inp_choice=document.getElementById("choice");
		choice.value=place.name;
		console.log(place.formatted_address);
		
		if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            var pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };
			console.log(pos);
            
          });
        } else {
          // Browser doesn't support Geolocation
          handleLocationError(false, infoWindow, map.getCenter());
        }
		
	}
</script>
	
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAQs1AhWqKf-H-TNVh6j1moFjTwBfAn97s&libraries=places&callback=activatePlacesSearch"></script>

</form>
<div class="chart-container">
<canvas id="myChart" width="200" height="200"></canvas>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0/dist/Chart.min.js"></script>
<script>
{% block jquery %}
	var endpoint='/api/data/'
	var defaultData=[]
	var labels=['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'];
	var gdata;
	$.ajax({
		method:"GET",
		url:endpoint,
		success: function(data){
			console.log(Object.keys(data))
			console.log(data)
			gdata=data;
			var ctx = document.getElementById('myChart').getContext('2d');
			var myChart = new Chart(ctx, {
				type: 'bar',
				data: {
					labels: Object.keys(data),
					datasets: [{
						label: 'Most Voted Restaurants',
						data: Object.values(data),
						backgroundColor: [ 'rgba(255, 99, 132, 0.2)', 'rgba(54, 162, 235, 0.2)', 'rgba(255, 206, 86, 0.2)', 'rgba(75, 192, 192, 0.2)', 'rgba(153, 102, 255, 0.2)', 'rgba(255, 159, 64, 0.2)' ], borderColor: [ 'rgba(255, 99, 132, 1)', 'rgba(54, 162, 235, 1)', 'rgba(255, 206, 86, 1)', 'rgba(75, 192, 192, 1)', 'rgba(153, 102, 255, 1)', 'rgba(255, 159, 64, 1)' ], borderWidth: 1 }] }, options: { scales: { yAxes: [{ ticks: { 	beginAtZero: true } }] } } });
		},
		error: function(error_data){
			console.log("error")
			console.log(error_data)
		}
	})
	console.log(gdata);
	

{% endblock %}
</script>

{% endblock %}



